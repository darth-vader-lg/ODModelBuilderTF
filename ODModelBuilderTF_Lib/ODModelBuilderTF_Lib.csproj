<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net5.0</TargetFramework>
    <ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>None</ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>
    <AssemblyName>ODModelBuilderTF</AssemblyName>
    <RootNamespace>ODModelBuilderTF</RootNamespace>
    <GeneratePackageOnBuild>false</GeneratePackageOnBuild>
    <Description>Train, evaluation, export library for TensorFlow object detection</Description>
    <Copyright>Copyright 2021 darth-vader-lg</Copyright>
    <PackageLicenseExpression />
    <PackageLicenseFile>licence.txt</PackageLicenseFile>
    <PackageProjectUrl>https://github.com/darth-vader-lg</PackageProjectUrl>
    <RepositoryUrl>https://github.com/darth-vader-lg/ODModelBuilderTF.git</RepositoryUrl>
    <RepositoryType>git</RepositoryType>
    <NeutralLanguage />
    <PackageId>ODModelBuilderTF</PackageId>
    <Platforms>AnyCPU</Platforms>
    <RunPostBuildEvent>OnBuildSuccess</RunPostBuildEvent>
  </PropertyGroup>

  <ItemGroup>
    <None Remove="py\Activate.ps1" />
    <None Remove="py\env.zip" />
  </ItemGroup>

  <ItemGroup>
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\requirements.txt" Link="py\requirements.txt" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\base_parameters.py" Link="py\base_parameters.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\default_cfg.py" Link="py\default_cfg.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\eval_environment.py" Link="py\eval_environment.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\eval_main.py" Link="py\eval_main.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\eval_parameters.py" Link="py\eval_parameters.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_environment.py" Link="py\export_environment.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_frozen_graph.py" Link="py\export_frozen_graph.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_main.py" Link="py\export_main.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_model_config.py" Link="py\export_model_config.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_onnx.py" Link="py\export_onnx.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\export_parameters.py" Link="py\export_parameters.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\install_virtual_environment.py" Link="py\install_virtual_environment.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\main.py" Link="py\main.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\model_types.py" Link="py\model_types.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\mount_google_drive.py" Link="py\mount_google_drive.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\od_install.py" Link="py\od_install.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\pretrained_model.py" Link="py\pretrained_model.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\tf_records.py" Link="py\tf_records.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\train_environment.py" Link="py\train_environment.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\train_main.py" Link="py\train_main.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\train_parameters.py" Link="py\train_parameters.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\train_pipeline.py" Link="py\train_pipeline.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\train_tensorboard.py" Link="py\train_tensorboard.py" />
    <EmbeddedResource Include="..\ODModelBuilderTF_Py\utilities.py" Link="py\utilities.py" />
    <EmbeddedResource Include="py\Activate.ps1" />
    <EmbeddedResource Include="py\env.zip" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="pythonnet_netstandard_py37_win" Version="2.5.2" />
  </ItemGroup>

  <ItemGroup>
    <None Update="licence.txt">
      <Pack>True</Pack>
      <PackagePath></PackagePath>
    </None>
  </ItemGroup>

  <Target Name="PreBuild" BeforeTargets="PreBuildEvent">
  </Target>

  <Target Name="ZipOutputPath" AfterTargets="PreBuild">
    <PropertyGroup>
      <EnvDir>$(ProjectDir)..\ODModelBuilderTF_Py\env</EnvDir>
      <BuildFile>$(EnvDir)\build-time.txt</BuildFile>
      <ZipFile>$(ProjectDir)py\env.zip</ZipFile>
      <BuildTimestamp>0</BuildTimestamp>
      <ZipTimestamp>0</ZipTimestamp>
      <BuildTimestamp Condition="Exists('$(BuildFile)')">$([System.IO.File]::GetLastWriteTime('$(BuildFile)').Ticks)</BuildTimestamp>
      <ZipTimestamp Condition="Exists('$(ZipFile)')">$([System.IO.File]::GetLastWriteTime('$(ZipFile)').Ticks)</ZipTimestamp>
    </PropertyGroup>
    <ZipDirectory Condition="$(BuildTimestamp) > $(ZipTimestamp)" SourceDirectory="$(EnvDir)" DestinationFile="$(ZipFile)" Overwrite="true" />
  </Target>

  <Target Name="PostBuild" AfterTargets="PostBuildEvent">
  </Target>

</Project>
